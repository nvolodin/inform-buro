!function(){"use strict";angular.module("informBuroApp",["ngRoute","informBuroApp.core"]).config(["$routeProvider",function(a){a.when("/search/:drug",{templateUrl:"views/search.html",controller:"SearchCtrl",controllerAs:"sc"}).when("/search",{templateUrl:"views/search.html",controller:"SearchCtrl",controllerAs:"sc"}).when("/drugStoreList/:cdprep/:cdform",{templateUrl:"views/drugStoreList.html",controller:"DrugStoreListCtrl",controllerAs:"dsc"}).otherwise({redirectTo:"/search"})}])}(),function(){"use strict";function a(a,b){function c(b,c){f.emit("send_gridtable1",["",b,,,"все","все","","",,,,,,,,,"",""]),f.on("grid_data1",function(){var b=arguments;a.$apply(function(){c.apply(f,b)})})}function d(b,c){var d=["","",b.cdprep,b.cdform,"все","Все","","",,,,,,,,,"",""];f.emit("send_gridtable4",d),f.on("grid_data4",function(){var b=arguments;a.$apply(function(){c.apply(f,b)})})}var e={getDrugs:c,getDrugStoresByDrug:d},f=b.connect("http:inform-buro.info:80");return f.on("error",function(){console.log("there was an error")}),e}angular.module("informBuroApp.core",[]),angular.module("informBuroApp.core").value("$io",io).factory("webSocket",a),a.$inject=["$rootScope","$io"]}(),function(){"use strict";angular.module("informBuroApp.core").filter("encodeUri",function(){return function(a){return window.btoa(encodeURIComponent(a))}})}(),function(){"use strict";angular.module("informBuroApp.core").directive("ngEnter",function(){return function(a,b,c){b.bind("keydown keypress",function(b){13===b.which&&(a.$apply(function(){a.$eval(c.ngEnter)}),b.preventDefault())})}})}(),function(){"use strict";function a(a,b){function c(){if(n.model={state:"list",order:{mode:"0",orderBy:"price",orderReverse:!1},drugStores:[]},b&&b.cdprep&&b.cdform){var c={cdprep:b.cdprep,cdform:b.cdform};n.model.drugStores=[],a.getDrugStoresByDrug(c,d)}}function d(a){n.model.drugStores=a}function e(){$(window).resize(h),f(),i()}function f(){ymaps.geolocation.get({mapStateAutoApply:!0}).then(function(a){var b=$("#map"),c=a.geoObjects.get(0).properties.get("boundedBy"),d=ymaps.util.bounds.getCenterAndZoom(c,[b.width(),b.height()]);d.zoom=15,k=k||g(d),o.proceedInit()},function(a){console.log(a),g({center:[55.751574,37.573856],zoom:2})})}function g(a){return new ymaps.Map("map",a)}function h(){clearTimeout(l),l=setTimeout(i,250)}function i(){var a=$("#map:visible");if(!a.length)return void(m=!0);m=!1;var b=$(window).height()-a.position().top;a.css("height",b),k&&k.container.fitToViewport()}function j(){function a(a){if(null==a)return null;if(!a.pos){var b=c.exec(a.map);b&&2==b.length&&(a.pos=$.parseJSON(b[1]),a.pos.lat=parseFloat(a.pos.lat),a.pos.lon=parseFloat(a.pos.lon))}return a.pos}function b(a,b){return a&&a.lat&&a.lon&&b&&2==b.length&&a.lat>b[0][0]&&a.lon>b[0][1]&&a.lat<b[1][0]&&a.lon<b[1][1]}var c=/"pos":({.*?})/gm,d={load:function(){var c=k.getBounds();k.geoObjects.removeAll();for(var e=0,f=0;e<n.model.drugStores.length&&20>f;e++){var g=n.model.drugStores[e];if(a(g),b(g.pos,c)){var h=new ymaps.Placemark([g.pos.lat,g.pos.lon],{iconContent:++f,balloonContent:d.generateBalloonContent(g)},{preset:{openBaloonOnClick:!0,preset:"twirl#blueDotIcon"},balloonMaxWidth:400});k.geoObjects.add(h)}}},proceedInit:function(){d.load(),k.events.add("boundschange",function(){k.balloon.isOpen()||d.load()})},generateBalloonContent:function(a){return'<div class="b-map-balloon-price">'+a.price+" руб.</div>"+(a.nmplant?'<div class="b-map-balloon-oname">'+a.nmplant+"</div>":"")+'<div class="b-map-balloon-shopname">'+a.nmfirm+'</div><div class="b-map-balloon-worktime">'+a.time+'</div><div class="b-map-balloon-addr">'+a.str+"</div>"}};return d}var k,l,m,n=this,o=j();c(),n.orderChanged=function(){switch(n.model.order.mode){case"0":n.model.order.orderBy="price",n.model.order.orderReverse=!1;break;case"1":n.model.order.orderBy="price",n.model.order.orderReverse=!0}},n.showMap=function(){n.model.state="maps",!k&&ymaps&&ymaps.ready(e),m&&setTimeout(i,1)}}angular.module("informBuroApp").controller("DrugStoreListCtrl",a),a.$inject=["webSocket","$routeParams"]}(),function(){"use strict";function a(a,b){function c(){if(b&&b.drug){var c=decodeURIComponent(b.drug);e.drugs=[],a.getDrugs(c,d)}}function d(a){e.drugs=$.grep(a,function(a){return a.prices})}var e=this;c()}angular.module("informBuroApp").controller("SearchCtrl",a),a.$inject=["webSocket","$routeParams"]}(),function(){"use strict";function a(a,b){function c(){d.searchText="",b.drug&&(d.searchText=decodeURIComponent(b.drug))}var d=this;c(),d.search=function(){d.searchText&&a.path("/search/"+encodeURIComponent(d.searchText))}}angular.module("informBuroApp").controller("SearchPanelCtrl",a),a.$inject=["$location","$routeParams"]}();
//# sourceMappingURL=app.min.js.map
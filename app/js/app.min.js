!function(){"use strict";angular.module("informBuroApp",["ngRoute","informBuroApp.core"]).config(["$routeProvider","$locationProvider",function(a,b){b.hashPrefix("!"),a.when("/search/:drug",{templateUrl:"views/search.html",controller:"SearchCtrl",controllerAs:"sc"}).when("/search",{templateUrl:"views/search.html",controller:"SearchCtrl",controllerAs:"sc"}).when("/drugStoreList/:cdprep/:cdform",{templateUrl:"views/drugStoreList.html",controller:"DrugStoreListCtrl",controllerAs:"dsc"}).when("/notFound",{templateUrl:"views/notFound.html"}).otherwise({redirectTo:"/search"})}])}(),function(){"use strict";function a(a,b){function c(b,c){g.emit("send_gridtable1",["input1",b,,,"1","САМАРА","","",,,,,,,,,"",""]),g.on("grid_data1",function(){var b=arguments;a.$apply(function(){c.apply(g,b)})})}function d(b,c){var d=["clickform1","",b.cdprep,b.cdform,"1","САМАРА","","",,,,,,,,,"",""];g.emit("send_gridtable4",d),g.on("grid_data4",function(){var b=arguments;a.$apply(function(){c.apply(g,b)})})}function e(b){g.emit("get_lekar_stat",""),g.on("lekar_stat_data",function(){var c=arguments;a.$apply(function(){b.apply(g,c)})})}var f={getDrugs:c,getDrugStoresByDrug:d,getFavorites:e},g=b.connect("http://inform-buro.info");return g.on("error",function(){console.log("there was an error")}),f}angular.module("informBuroApp.core",[]),angular.module("informBuroApp.core").value("$io",io).factory("webSocket",a),a.$inject=["$rootScope","$io"]}(),function(){"use strict";angular.module("informBuroApp.core").filter("encodeUri",function(){return function(a){return window.btoa(encodeURIComponent(a))}})}(),function(){"use strict";angular.module("informBuroApp.core").directive("ngEnter",function(){return function(a,b,c){b.bind("keydown keypress",function(b){13===b.which&&(a.$apply(function(){a.$eval(c.ngEnter)}),b.preventDefault())})}})}(),function(){"use strict";function a(a,b,c){function d(){if(o.model={state:"list",order:{mode:"0",orderBy:"price",orderReverse:!1},drugStores:[]},b&&b.cdprep&&b.cdform){var c={cdprep:b.cdprep,cdform:b.cdform};o.model.drugStores=[],a.getDrugStoresByDrug(c,e)}}function e(a){o.model.drugStores=a,o.model.groupedDrugStores=f(a),o.model.drugStores.length||c.path("/notFound")}function f(a){for(var b,c,d={},e=[],f=0;f<a.length;f++)b=a[f],null==d[b.cdfirm]&&(d[b.cdfirm]=e.length),c=d[b.cdfirm],e[c]=e[c]||{cdfirm:b.cdfirm,pos:{lat:b.map2,lon:b.map1},nmfirm:b.nmfirm,phones:b.phones,str:b.str,time:b.time,products:[]},e[c].products.push({nmplant:b.nmplant,price:b.price});return e}function g(){$(window).resize(j),h(),k()}function h(){var a=["zoomControl","fullscreenControl","geolocationControl"];ymaps.geolocation.get({mapStateAutoApply:!0}).then(function(b){var c=$("#map"),d=b.geoObjects.get(0).properties.get("boundedBy"),e=ymaps.util.bounds.getCenterAndZoom(d,[c.width(),c.height()]);e.zoom=15,e.controls=a,m=m||i(e),q.proceedInit()},function(b){console.log(b),i({center:[55.751574,37.573856],zoom:2,controls:a})})}function i(a){return new ymaps.Map("map",a)}function j(){clearTimeout(n),n=setTimeout(k,250)}function k(){var a=$("#map:visible");if(!a.length)return void(p=!0);p=!1;var b=$(window).height()-a.position().top;a.css("height",b),m&&m.container.fitToViewport()}function l(){function a(a){for(var b="",c=0;c<a.length;c++)b+='<div><div class="b-map-balloon-price">'+a[c].price+" руб.</div>"+(a[c].nmplant?'<div class="b-map-balloon-oname">'+a[c].nmplant+"</div>":"")+"</div>";return b}function b(a,b){return a&&a.lat&&a.lon&&b&&2==b.length&&a.lat>b[0][0]&&a.lon>b[0][1]&&a.lat<b[1][0]&&a.lon<b[1][1]}function c(a){if(o.model&&o.model.drugStores&&a){var b,c=a.call(),d=!1;for(b=c;!d;){if(b>=0&&b<o.model.groupedDrugStores.length){var e=o.model.groupedDrugStores[b];e.pos&&e.pos.lat&&e.pos.lon&&(m.balloon.isOpen()&&m.balloon.close(),m.setCenter([e.pos.lat,e.pos.lon]),d=!0)}d||(b=a.call(),b==c&&(d=!0))}}}function d(){c(function(){return f++,f>=o.model.groupedDrugStores.length&&(f=0),f})}function e(){c(function(){return f--,0>f&&(f=o.model.groupedDrugStores.length-1),f})}var f=-1,g=20,h={load:function(){var a=m.getBounds();m.geoObjects.removeAll();for(var c=0,d=0;c<o.model.groupedDrugStores.length&&g>d;c++){var e=o.model.groupedDrugStores[c];if(b(e.pos,a)){var f=new ymaps.Placemark([e.pos.lat,e.pos.lon],{iconContent:++d,balloonContent:h.generateBalloonContent(e)},{preset:{openBaloonOnClick:!0,preset:"twirl#blueDotIcon"},balloonMaxWidth:400});m.geoObjects.add(f)}}},proceedInit:function(){var a=new ymaps.control.Button({data:{iconType:"prevDrugStore nav-drug-store glyphicon glyphicon-triangle-left",title:"Предыдущая аптека"},options:{selectOnClick:!1,"float":"right"}}),b=new ymaps.control.Button({data:{iconType:"prevDrugStore nav-drug-store glyphicon glyphicon-triangle-right",title:"Следующая аптека"},options:{selectOnClick:!1,"float":"right"}});a.events.add("click",e),b.events.add("click",d),m.controls.add(a).add(b),h.load(),m.events.add("boundschange",function(){m.balloon.isOpen()||h.load()})},generateBalloonContent:function(b){return a(b.products)+'<div class="b-map-balloon-shopname">'+b.nmfirm+'</div><div class="b-map-balloon-worktime">'+b.time+'</div><div class="b-map-balloon-addr">'+b.str+"</div>"}};return h}var m,n,o=this,p=!0,q=l();d(),o.orderChanged=function(){switch(o.model.order.mode){case"0":o.model.order.orderBy="price",o.model.order.orderReverse=!1;break;case"1":o.model.order.orderBy="price",o.model.order.orderReverse=!0}},o.showMap=function(){o.model.state="maps",ymaps&&(!m&&ymaps&&ymaps.ready(g),p&&setTimeout(k,1))}}angular.module("informBuroApp").controller("DrugStoreListCtrl",a),a.$inject=["webSocket","$routeParams","$location"]}(),function(){"use strict";function a(a,b,c){function d(){if(b&&b.drug){var c=decodeURIComponent(b.drug);g.drugs=[],g.favorites=[],a.getDrugs(c,e)}else a.getFavorites(f)}function e(a){g.favorites=[],g.drugs=$.grep(a,function(a){return a.prices}),g.drugs.length||c.path("/notFound")}function f(a){g.favorites=a}var g=this;d(),g.getDrugOffersCount=function(a){if(!a)return"";var b=a.toString(),c=b.length?b[b.length-1]:"0",d=b.length>1?b[b.length-2]:"0",e="";if("1"==d||"5"===c||"6"===c||"7"===c||"8"===c||"9"===c||"0"===c)e="й";else if("1"===c)e="е";else{if("2"!==c&&"3"!==c&&"4"!==c)return"";e="я"}return a+" предложени"+e}}angular.module("informBuroApp").controller("SearchCtrl",a),a.$inject=["webSocket","$routeParams","$location"]}(),function(){"use strict";function a(a,b){function c(){d.searchText="",b.drug&&(d.searchText=decodeURIComponent(b.drug))}var d=this;c(),d.search=function(){d.searchText&&a.path("/search/"+encodeURIComponent(d.searchText))}}angular.module("informBuroApp").controller("SearchPanelCtrl",a),a.$inject=["$location","$routeParams"]}();
//# sourceMappingURL=app.min.js.map
!function(){"use strict";angular.module("informBuroApp",["ngRoute","informBuroApp.core"]).config(["$routeProvider","$locationProvider",function(a,b){b.hashPrefix("!"),a.when("/search/:drug",{templateUrl:"views/search.html",controller:"SearchCtrl",controllerAs:"sc"}).when("/search",{templateUrl:"views/search.html",controller:"SearchCtrl",controllerAs:"sc"}).when("/drugStoreList/:cdprep/:cdform",{templateUrl:"views/drugStoreList.html",controller:"DrugStoreListCtrl",controllerAs:"dsc"}).otherwise({redirectTo:"/search"})}])}(),function(){"use strict";function a(a,b){function c(b,c){f.emit("send_gridtable1",["",b,,,"все","все","","",,,,,,,,,"",""]),f.on("grid_data1",function(){var b=arguments;a.$apply(function(){c.apply(f,b)})})}function d(b,c){var d=["","",b.cdprep,b.cdform,"все","Все","","",,,,,,,,,"",""];f.emit("send_gridtable4",d),f.on("grid_data4",function(){var b=arguments;a.$apply(function(){c.apply(f,b)})})}var e={getDrugs:c,getDrugStoresByDrug:d},f=b.connect("http:inform-buro.info:80");return f.on("error",function(){console.log("there was an error")}),e}angular.module("informBuroApp.core",[]),angular.module("informBuroApp.core").value("$io",io).factory("webSocket",a),a.$inject=["$rootScope","$io"]}(),function(){"use strict";angular.module("informBuroApp.core").filter("encodeUri",function(){return function(a){return window.btoa(encodeURIComponent(a))}})}(),function(){"use strict";angular.module("informBuroApp.core").directive("ngEnter",function(){return function(a,b,c){b.bind("keydown keypress",function(b){13===b.which&&(a.$apply(function(){a.$eval(c.ngEnter)}),b.preventDefault())})}})}(),function(){"use strict";function a(a,b){function c(){if(m.model={state:"list",order:{mode:"0",orderBy:"price",orderReverse:!1},drugStores:[]},b&&b.cdprep&&b.cdform){var c={cdprep:b.cdprep,cdform:b.cdform};m.model.drugStores=[],a.getDrugStoresByDrug(c,d)}}function d(a){m.model.drugStores=a}function e(){$(window).resize(h),f(),i()}function f(){var a=["zoomControl","fullscreenControl","geolocationControl"];ymaps.geolocation.get({mapStateAutoApply:!0}).then(function(b){var c=$("#map"),d=b.geoObjects.get(0).properties.get("boundedBy"),e=ymaps.util.bounds.getCenterAndZoom(d,[c.width(),c.height()]);e.zoom=15,e.controls=a,k=k||g(e),o.proceedInit()},function(b){console.log(b),g({center:[55.751574,37.573856],zoom:2,controls:a})})}function g(a){return new ymaps.Map("map",a)}function h(){clearTimeout(l),l=setTimeout(i,250)}function i(){var a=$("#map:visible");if(!a.length)return void(n=!0);n=!1;var b=$(window).height()-a.position().top;a.css("height",b),k&&k.container.fitToViewport()}function j(){function a(a){if(null==a)return null;if(!a.pos){var b=f.exec(a.map);b&&2==b.length&&(a.pos=$.parseJSON(b[1]),a.pos.lat=parseFloat(a.pos.lat),a.pos.lon=parseFloat(a.pos.lon))}return a.pos}function b(a,b){return a&&a.lat&&a.lon&&b&&2==b.length&&a.lat>b[0][0]&&a.lon>b[0][1]&&a.lat<b[1][0]&&a.lon<b[1][1]}function c(b){if(m.model&&m.model.drugStores&&b){var c,d=b.call(),e=!1;for(c=d;!e;){if(c>=0&&c<m.model.drugStores.length){var f=m.model.drugStores[c];a(f),f.pos&&f.pos.lat&&f.pos.lon&&(k.balloon.isOpen()&&k.balloon.close(),k.setCenter([f.pos.lat,f.pos.lon]),e=!0)}e||(c=b.call(),c==d&&(e=!0))}}}function d(){c(function(){return g++,g>=m.model.drugStores.length&&(g=0),g})}function e(){c(function(){return g--,0>g&&(g=m.model.drugStores.length-1),g})}var f=/"pos":({.*?})/gm,g=-1,h=20,i={load:function(){var c=k.getBounds();k.geoObjects.removeAll();for(var d=0,e=0;d<m.model.drugStores.length&&h>e;d++){var f=m.model.drugStores[d];if(a(f),b(f.pos,c)){var g=new ymaps.Placemark([f.pos.lat,f.pos.lon],{iconContent:++e,balloonContent:i.generateBalloonContent(f)},{preset:{openBaloonOnClick:!0,preset:"twirl#blueDotIcon"},balloonMaxWidth:400});k.geoObjects.add(g)}}},proceedInit:function(){var a=new ymaps.control.Button({data:{iconType:"prevDrugStore glyphicon glyphicon-triangle-left",title:"Предыдущая аптека"},options:{selectOnClick:!1,"float":"right"}}),b=new ymaps.control.Button({data:{iconType:"prevDrugStore glyphicon glyphicon-triangle-right",title:"Следующая аптека"},options:{selectOnClick:!1,"float":"right"}});a.events.add("click",e),b.events.add("click",d),k.controls.add(a).add(b),i.load(),k.events.add("boundschange",function(){k.balloon.isOpen()||i.load()})},generateBalloonContent:function(a){return'<div class="b-map-balloon-price">'+a.price+" руб.</div>"+(a.nmplant?'<div class="b-map-balloon-oname">'+a.nmplant+"</div>":"")+'<div class="b-map-balloon-shopname">'+a.nmfirm+'</div><div class="b-map-balloon-worktime">'+a.time+'</div><div class="b-map-balloon-addr">'+a.str+"</div>"}};return i}var k,l,m=this,n=!0,o=j();c(),m.orderChanged=function(){switch(m.model.order.mode){case"0":m.model.order.orderBy="price",m.model.order.orderReverse=!1;break;case"1":m.model.order.orderBy="price",m.model.order.orderReverse=!0}},m.showMap=function(){m.model.state="maps",!k&&ymaps&&ymaps.ready(e),n&&setTimeout(i,1)}}angular.module("informBuroApp").controller("DrugStoreListCtrl",a),a.$inject=["webSocket","$routeParams"]}(),function(){"use strict";function a(a,b){function c(){if(b&&b.drug){var c=decodeURIComponent(b.drug);e.drugs=[],a.getDrugs(c,d)}}function d(a){e.drugs=$.grep(a,function(a){return a.prices})}var e=this;c()}angular.module("informBuroApp").controller("SearchCtrl",a),a.$inject=["webSocket","$routeParams"]}(),function(){"use strict";function a(a,b){function c(){d.searchText="",b.drug&&(d.searchText=decodeURIComponent(b.drug))}var d=this;c(),d.search=function(){d.searchText&&a.path("/search/"+encodeURIComponent(d.searchText))}}angular.module("informBuroApp").controller("SearchPanelCtrl",a),a.$inject=["$location","$routeParams"]}();
//# sourceMappingURL=app.min.js.map